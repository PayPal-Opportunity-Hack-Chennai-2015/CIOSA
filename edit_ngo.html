<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="">
      <meta name="author" content="">
      <title>Sahayak</title>
      <!-- Bootstrap Core CSS -->
      <link href="css/bootstrap.min.css" rel="stylesheet">
      <!-- Custom CSS -->
      <link href="css/homepage.css" rel="stylesheet">
      <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
      <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
      <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
      <![endif]-->
      <head>
         <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
   </head>
   </head>
   <body>
      <!-- Navigation -->
      <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
         <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
               <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
               <span class="sr-only">Toggle navigation</span>
               <span class="icon-bar"></span>
               <span class="icon-bar"></span>
               <span class="icon-bar"></span>
               </button>
               <a class="navbar-brand" href="#">Sahayak</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
               <ul class="nav navbar-nav">
                  <li>
                     <a href="#">About</a>
                  </li>
                  <li>
                     <a href="#">Contact</a>
                  </li>
               </ul>
            </div>
            <!-- /.navbar-collapse -->
         </div>
         <!-- /.container -->
      </nav>
      <!-- Page Content -->
      <div class="container">
         <div class="row">
            <div class="col-md-12">
               <div>
                  <br>
                  <form class="form-horizontal" id="asdfform" type="post" role="form">
					 <input type="hidden" name="id" id="id" value="">
                     <div class="form-group">
                        <label class="control-label col-sm-2" for="name">Name</label>
                        <div class="col-sm-10">
                           <input type="text" class="form-control" id="name" placeholder="Enter name">
                        </div>
                     </div>
                     <div class="form-group">
                        <label class="control-label col-sm-2" for="category">Category</label>
                        <div class="col-sm-10">
                           <input type="text" class="form-control" id="category" placeholder="Enter categories">
                        </div>
                     </div>
                     <div class="form-group">
                        <label class="control-label col-sm-2" for="line1">Address Line1</label>
                        <div class="col-sm-10"> 
                           <input type="text" class="form-control" id="line1" placeholder="Address Line1">
                        </div>
                     </div>
                     <div class="form-group">
                        <label class="control-label col-sm-2" for="line2">Address Line2</label>
                        <div class="col-sm-10"> 
                           <input type="text" class="form-control" id="line2" placeholder="street">
                        </div>
                     </div>
                     <div class="form-group">
                        <label class="control-label col-sm-2" for="area">Area</label>
                        <div class="col-sm-10"> 
                           <input type="text" class="form-control" id="area" placeholder="Area">
                        </div>
                     </div>
                     <div class="form-group">
                        <label class="control-label col-sm-2" for="city">City</label>
                        <div class="col-sm-10"> 
                           <input type="text" class="form-control" id="city" placeholder="City">
                        </div>
                     </div>
                     <div class="form-group">
                        <label class="control-label col-sm-2" for="state">State</label>
                        <div class="col-sm-10"> 
                           <input type="text" class="form-control" id="state" placeholder="State">
                        </div>
                     </div>
                     <div class="form-group">
                        <label class="control-label col-sm-2" for="poc">Point of Contact- Name</label>
                        <div class="col-sm-10"> 
                           <input type="text" class="form-control" id="poc" placeholder="Person Name">
                        </div>
                     </div>
                     <div class="form-group">
                        <label class="control-label col-sm-2" for="phone">Phone</label>
                        <div class="col-sm-10"> 
                           <input type="text" class="form-control" id="phone" placeholder="phone">
                        </div>
                     </div>
                     <div class="form-group">
                        <label class="control-label col-sm-2" for="email">Email</label>
                        <div class="col-sm-10"> 
                           <input type="email" class="form-control" id="email" placeholder="email@asdf.com">
                        </div>
                     </div>
                     <div class="form-group">
                        <label class="control-label col-sm-2" for="phone">Website</label>
                        <div class="col-sm-10"> 
                           <input type="text" class="form-control" id="website-url" placeholder="www.yoururl.com">
                        </div>
                     </div>
                     <div class="form-group">
                        <label class="control-label col-sm-2" for="description">Description</label>
                        <div class="col-sm-10"> 
                           <input type="text" class="form-control" id="description" placeholder="Description">
                        </div>
                     </div>
                     <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                           <button id="add_suggestion" type="submit" class="btn btn-default">Submit Suggestion For Review</button>
                        </div>
                     </div>
                  </form>
               </div>
            </div>
         </div>
      </div>
      <!-- /.container -->
      <div class="container">
         <hr>
         <!-- Footer -->
         <footer>
            <div class="row">
               <div class="col-lg-12">
                  <p>Copyright &copy; Your Website 2014</p>
               </div>
            </div>
         </footer>
      </div>
      <!-- /.container -->
      <!-- jQuery -->
      <!-- Bootstrap Core JavaScript -->
      <script src="js/bootstrap.min.js"></script>
      <script type="text/javascript">
         var getUrlParameter = function getUrlParameter(sParam) {
            var sPageURL = decodeURIComponent(window.location.search.substring(1)),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;
         
            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');
         
                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : sParameterName[1];
                }
            }
         };
		 
		 var loaddata =function(){
			var param=getUrlParameter('id');
			if(param){
				var myUrl='http://lm-maa-26500421.paypalcorp.com:9200/sahayak/ngodetails/';
				myUrl=myUrl.concat(param);
				myUrl = myUrl.toString().replace(/"/g, "");
				console.log(myUrl);
			} else {
				alert("Error: No ID")
			}
            $.ajax({
                    url: myUrl,
                    type: 'get',
                    dataType: 'json',
                    success: function (data) {
						if(!data.found) {
							alert("Error in loading");
						} else {
							$("#id").val(data._id);
							$("#name").val(data._source.name);
							$("#line1").val(data._source.address.line1);
							$("#line2").val(data._source.address.line2);
							$("#area").val(data._source.address.area);
							$("#city").val(data._source.address.city);
							$("#state").val(data._source.address.state);
							$("#poc").val(data._source.poc);
							$("#phone").val(data._source.phone);
							$("#email").val(data._source.email);
							$("#website-url").val(data._source.website);
							$("#description").val(data._source.desc);
						}
                    }
                });
         }
		 
         $( document ).ready(function() {
		    loaddata();
         	$("#add_suggestion").click(function(){
				var area=$("#area").val();
				var city=$("#city").val()+"+"+$("#state").val();
				var country="IN";
				jQuery.ajax({
					url: "http://maps.google.com/maps/api/geocode/json?address="+area+"+"+city+"+"+country,
					success: function (result) {
						if (result.isOk == false) alert(result.results);
							if(result.results && result.results.length>=1){
								lat = result.results[0].geometry.location.lat;
								lon = result.results[0].geometry.location.lng; 
								alert("Data: " + lat+","+lon);
							
							    var mydata={"doc":{
							         "name": $("#name").val(),
									 "logo": "",
									 "address": {
										"line1": $("#line1").val(),
										"line2": $("#line2").val(),
										"area": $("#area").val(),
										"city": $("#city").val(),
										"state": $("#state").val()
									},
									"location": {
										"lat": lat,
										"lon": lon
									},
									"poc": $("#poc").val(),
									"phone": $("#phone").val(),
									"email": $("#email").val(),
									"website": $("#website-url").val(),
									"desc": $("#description").val(),
									"category": "",
									}
								}
							    console.log(mydata);
								var id =$("#id").val();
								if(id){
									myUrl='http://lm-maa-26500421.paypalcorp.com:9200/sahayak/ngodetails/'+id+'/_update'
									console.log(myUrl);
								} else {
									return;
								}
								$.ajax({
									url: myUrl,
									type: 'post',
									dataType: 'json',
									success: function (data) {
										alert(data);
									},
									data: JSON.stringify(mydata)
								});
							}
						},
					async: false
				});
			});
         });
       
      </script>
   </body>
</html>